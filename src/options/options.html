<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitLab Plus - Settings</title>
    <link rel="stylesheet" href="options.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>GitLab Plus Settings</h1>
        <p class="subtitle">Configure your GitLab enhancement experience</p>
      </header>

      <!-- Token Section -->
      <section class="card" id="token-section">
        <h2>GitLab Personal Access Token</h2>
        <p class="description">
          Required for extension features. Create a token at
          <a
            href="https://gitlab.com/-/user_settings/personal_access_tokens"
            target="_blank"
            >GitLab Settings → Access Tokens</a
          >
          with the following scopes:
        </p>
        <ul class="scope-list">
          <li>
            <code>api</code> — Full API access (required for adding reviewers to
            MRs)
          </li>
          <li>
            <code>read_user</code> — Read user info (required for searching
            users in your organization)
          </li>
        </ul>

        <div class="token-status" id="token-status">
          <span class="status-indicator" id="status-indicator"></span>
          <span id="status-text">Checking...</span>
        </div>

        <div class="user-info" id="user-info" style="display: none">
          <img id="user-avatar" src="" alt="Avatar" class="avatar" />
          <div>
            <strong id="user-name"></strong>
            <span id="user-username"></span>
          </div>
        </div>

        <div class="token-input-group">
          <input
            type="password"
            id="token-input"
            placeholder="glpat-xxxxxxxxxxxxxxxxxxxx"
            autocomplete="off"
          />
          <button id="toggle-visibility" class="btn-icon" title="Show/Hide">
            <span class="eye-icon">&#128065;</span>
          </button>
        </div>

        <div class="button-group">
          <button id="validate-btn" class="btn btn-primary">
            Validate & Save
          </button>
          <button id="clear-btn" class="btn btn-danger" style="display: none">
            Clear Token
          </button>
        </div>

        <div id="token-error" class="error-message" style="display: none"></div>

        <div class="form-group" id="group-config" style="margin-top: 16px">
          <label for="gitlab-group">GitLab Group</label>
          <select id="gitlab-group" disabled>
            <option value="">-- Configure token first --</option>
          </select>
          <small
            >Select your organization to search users within your team.</small
          >
        </div>
      </section>

      <!-- Quick Filters Section -->
      <section class="card" id="filters-section">
        <h2>Quick Filters</h2>
        <p class="description">
          Create quick filter buttons that appear on MR list pages.
        </p>

        <div id="filters-list" class="items-list">
          <div class="loading-indicator" id="filters-loading">
            <span class="spinner"></span>
            <span>Loading filters...</span>
          </div>
        </div>

        <button id="add-filter-btn" class="btn btn-secondary" style="display: none">
          + Add Filter
        </button>

        <!-- Add/Edit Filter Modal -->
        <div id="filter-modal" class="modal" style="display: none">
          <div class="modal-content">
            <h3 id="filter-modal-title">Add Filter</h3>

            <div class="form-group">
              <label for="filter-name">Filter Name</label>
              <input type="text" id="filter-name" placeholder="e.g., My bugs to review" />
            </div>

            <h4 class="filter-params-title">Filter Parameters</h4>
            <p class="description filter-params-description">Enable and configure the parameters you want. Leave unchecked to ignore.</p>

            <!-- Author -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-author-enabled" />
                Author
              </label>
              <div class="param-input" id="param-author-input" style="display: none">
                <div class="username-search">
                  <input type="text" id="filter-author" placeholder="Search user or type @me" autocomplete="off" />
                  <div id="author-search-results" class="search-results" style="display: none"></div>
                </div>
              </div>
            </div>

            <!-- Assignee -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-assignee-enabled" />
                Assignee
              </label>
              <div class="param-input" id="param-assignee-input" style="display: none">
                <div class="username-search">
                  <input type="text" id="filter-assignee" placeholder="Search user or type @me, then press Enter" autocomplete="off" />
                  <div id="assignee-search-results" class="search-results" style="display: none"></div>
                </div>
                <div id="filter-assignee-tags" class="filter-tags"></div>
              </div>
            </div>

            <!-- Reviewer -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-reviewer-enabled" />
                Reviewer
              </label>
              <div class="param-input" id="param-reviewer-input" style="display: none">
                <div class="username-search">
                  <input type="text" id="filter-reviewer" placeholder="Search user or type @me" autocomplete="off" />
                  <div id="reviewer-search-results" class="search-results" style="display: none"></div>
                </div>
              </div>
            </div>

            <!-- Labels -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-label-enabled" />
                Labels
              </label>
              <div class="param-input" id="param-label-input" style="display: none">
                <input type="text" id="filter-label" placeholder="Type label name and press Enter" />
                <div id="filter-label-tags" class="filter-tags"></div>
              </div>
            </div>

            <!-- State (optional now) -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-state-enabled" />
                State
              </label>
              <div class="param-input" id="param-state-input" style="display: none">
                <select id="filter-state">
                  <option value="opened">Opened</option>
                  <option value="merged">Merged</option>
                  <option value="closed">Closed</option>
                  <option value="all">All</option>
                </select>
              </div>
            </div>

            <!-- Draft -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-draft-enabled" />
                Draft status
              </label>
              <div class="param-input" id="param-draft-input" style="display: none">
                <select id="filter-draft">
                  <option value="no">Not draft (ready for review)</option>
                  <option value="yes">Draft only</option>
                </select>
              </div>
            </div>

            <!-- Search -->
            <div class="filter-param-row">
              <label class="checkbox-label">
                <input type="checkbox" id="param-search-enabled" />
                Search text
              </label>
              <div class="param-input" id="param-search-input" style="display: none">
                <input type="text" id="filter-search" placeholder="Type search term and press Enter" />
                <div id="filter-search-tags" class="filter-tags"></div>
              </div>
            </div>

            <div class="button-group">
              <button id="filter-save-btn" class="btn btn-primary">Save</button>
              <button id="filter-cancel-btn" class="btn btn-secondary">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Reviewer Presets Section -->
      <section class="card" id="presets-section">
        <h2>Reviewer Presets</h2>
        <p class="description">
          Create groups of reviewers to quickly add when creating merge
          requests.
        </p>

        <div id="presets-list" class="items-list">
          <div class="loading-indicator" id="presets-loading">
            <span class="spinner"></span>
            <span>Loading presets...</span>
          </div>
        </div>

        <button id="add-preset-btn" class="btn btn-secondary" style="display: none">
          + Add Preset
        </button>

        <!-- Add/Edit Preset Modal -->
        <div id="preset-modal" class="modal" style="display: none">
          <div class="modal-content">
            <h3 id="preset-modal-title">Add Reviewer Preset</h3>

            <div class="form-group">
              <label for="preset-name">Preset Name</label>
              <input
                type="text"
                id="preset-name"
                placeholder="e.g., Frontend Team"
              />
            </div>

            <div class="form-group">
              <label>Reviewers</label>
              <div class="reviewer-search">
                <input
                  type="text"
                  id="reviewer-search"
                  placeholder="Search users..."
                />
                <div
                  id="search-results"
                  class="search-results"
                  style="display: none"
                ></div>
              </div>
              <div id="selected-reviewers" class="selected-reviewers">
                <!-- Selected reviewers will be shown here -->
              </div>
            </div>

            <div class="button-group">
              <button id="preset-save-btn" class="btn btn-primary">Save</button>
              <button id="preset-cancel-btn" class="btn btn-secondary">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Preferences Section -->
      <section class="card" id="preferences-section">
        <h2>Preferences</h2>

        <h3 class="pref-section-title">Core Features</h3>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="pref-enable-filters" checked />
            Enable quick filters on MR list pages
          </label>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="pref-enable-presets" checked />
            Enable reviewer presets on MR creation
          </label>
        </div>

        <h3 class="pref-section-title">MR List Enhancements</h3>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="pref-enable-draft-dimming" checked />
            Dim draft/WIP merge requests
          </label>
          <small>Reduces opacity of MRs with "Draft:" or "WIP:" prefix</small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="pref-enable-age-indicator" checked />
            Show MR age indicators
          </label>
          <small>Adds colored badges for aging/stale MRs</small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="pref-enable-quick-approve" checked />
            Show quick approve button
          </label>
          <small
            >Adds an approve button on each MR row (requires API token)</small
          >
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="pref-enable-copy-mr-link" checked />
            Show copy link button
          </label>
          <small>Adds a button to copy MR link next to each MR title</small>
        </div>

        <div class="form-group">
          <label for="pref-copy-link-format">Copy link format</label>
          <select id="pref-copy-link-format">
            <option value="markdown">Markdown - [Title](URL)</option>
            <option value="url">URL only - https://...</option>
            <option value="title_url">Title + URL - Title: URL</option>
            <option value="rich">Rich text - clickable title</option>
          </select>
          <small>Choose how the MR link is formatted when copied</small>
        </div>

        <div class="form-group">
          <label for="pref-stale-mr-days">Stale MR threshold (days)</label>
          <input
            type="number"
            id="pref-stale-mr-days"
            value="7"
            min="1"
            max="30"
            style="width: 80px"
          />
          <small>MRs older than this are marked as stale</small>
        </div>

        <button id="save-prefs-btn" class="btn btn-primary">
          Save Preferences
        </button>
      </section>

      <footer>
        <p>GitLab Plus v1.2.0</p>
      </footer>
    </div>

    <script src="options.js"></script>
  </body>
</html>
